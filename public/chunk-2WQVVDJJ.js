import{a as n}from"./chunk-FDL32AD7.js";import{a as o}from"./chunk-G27EFIGX.js";import{i as u,j as f}from"./chunk-BGUH4UV6.js";import{a as d,b as l}from"./chunk-DRMASW6M.js";var g=class{static async setProduct({id:e,setProduct:t,setProductLoading:a,navigate:c,isMounted:r}){try{let s=await n.getProduct(e);r&&(s&&t(s),a(!1))}catch(s){c("/404",{replace:!1})}}static async setPledgeData({setUserPledgeData:e,productId:t,isMounted:a}){let{currentUser:c}=u();if(c){let{pledges:r}=await o.get(c.uid),s;for(let i=0;i<r.length;i+=1)if(r[i].product.productUID===t){s=r[i];break}s&&a&&e(s)}}static async submitProductUpdate({id:e,data:t,setAlert:a,navigate:c,setDescriptionError:r}){if(e!==void 0&&a!==null&&r)if(this.isUpdateValid(t.description,r))try{await n.updateProduct(e,t),a({message:"Successfully updated product!",type:"success"}),c(`/products/${e}`,{replace:!1})}catch(s){a({message:s.message,type:"error"})}else a({message:"Form data invalid.",type:"error"})}static isUpdateValid(e,t){return e.length>f.PRODUCT_DESCRIPTION_MAXLENGTH?(t(!0),!1):(t(!1),!0)}static async submitPledge({id:e,pledgeAmount:t,setPledgeError:a,setSubmitLoading:c}){e!==void 0&&this.isPledgeValid(t,a)&&(c(!0),await o.createCheckoutSession(e,t),c(!1))}static isPledgeValid(e,t){return e?e.length>12||!/^[+-]?[0-9]{1,3}(?:,?[0-9]{3})*(?:\.[0-9]{2})?$/.test(e)?(t(!0),!1):(t(!1),!0):(t(!1),!1)}static async deleteProduct({id:e,data:t,setAlert:a,navigate:c}){if(e!==void 0&&a!==null)try{await n.delete(e);let{currentUser:r}=u();if(r){let s=await o.get(r.uid);s.products=s.products.filter(i=>i.productUID!==e),await o.updateDB(r.uid,s),await n.updateLatestProducts(l(d({},t),{productUID:e}),!0),c("/products",{replace:!1}),a({message:"Deleted product campaign.",type:"success"})}else throw new Error("Missing current user.")}catch(r){a({message:r.message,type:"error"})}}},D=g;export{D as a};
